#include <stdio.h>
#include <string.h>

#define ROWS 4
#define COLS 4

// Sender side: calculate and show 2D parity
void paritySender2D() {
    char data[ROWS][COLS + 1];  // +1 for null terminator
    int rowParity[ROWS] = {0};
    int colParity[COLS] = {0};

    printf("Enter %d rows of %d-bit binary data:\n", ROWS, COLS);
    for (int i = 0; i < ROWS; i++) {
        scanf("%s", data[i]);
        for (int j = 0; j < COLS; j++) {
            if (data[i][j] == '1') {
                rowParity[i]++;
                colParity[j]++;
            }
        }
    }

    printf("Row Parity: ");
    for (int i = 0; i < ROWS; i++) {
        printf("%d", rowParity[i] % 2);
    }
    printf("\n");

    printf("Column Parity: ");
    for (int j = 0; j < COLS; j++) {
        printf("%d", colParity[j] % 2);
    }
    printf("\n");
}

// Receiver side: check 2D parity and give simple result
void parityReceiver2D() {
    char received[ROWS][COLS + 2];  // +1 for row parity, +1 for null terminator
    char colParity[COLS + 1];

    printf("Enter received data (%d rows of %d+1 bits with row parity):\n", ROWS, COLS);
    for (int i = 0; i < ROWS; i++) {
        scanf("%s", received[i]);
    }

    printf("Enter received column parity (%d bits): ", COLS);
    scanf("%s", colParity);

    int error = 0;

    // Check row parity
    for (int i = 0; i < ROWS; i++) {
        int count = 0;
        for (int j = 0; j < COLS + 1; j++) {
            if (received[i][j] == '1') {
                count++;
            }
        }
        if (count % 2 != 0) {
            error = 1;
            break;
        }
    }

    // Check column parity
    for (int j = 0; j < COLS; j++) {
        int count = 0;
        for (int i = 0; i < ROWS; i++) {
            if (received[i][j] == '1') {
                count++;
            }
        }
        if ((count % 2) != (colParity[j] - '0')) {
            error = 1;
            break;
        }
    }

    if (!error) {
        printf("✅ No Error: Data received correctly.\n");
    } else {
        printf("❌ Error detected in received data!\n");
    }
}

// Main menu
int main() {
    int choice;
    printf("1. 2D Parity Sender\n");
    printf("2. 2D Parity Receiver\n");
    printf("Enter your choice: ");
    scanf("%d", &choice);

    if (choice == 1) {
        paritySender2D();
    } else if (choice == 2) {
        parityReceiver2D();
    } else {
        printf("Invalid choice.\n");
    }

    return 0;
}
